<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    {% load i18n %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/exlchi.css' %}" type="text/css">
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <link rel="icon" href="{% static 'images/favicon.ico' %}">
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'font/css/font-awesome.min.css' %}" rel="stylesheet">
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <title>Book Detail</title>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th width="200px">id</th>
                <th width="200px">状态</th>
                <th width="200px">位置</th>
                {% if not administrator %}
                <th width="200px">预约</th>
                {% endif %}
                <th width="200px"></th>

            </tr>
        </thead>
        <tbody>
            {% for book in books %}
                <tr>
                    <td>{{ book.book_id}}</td>
                    <td>
                        {% if book.status == 0 %}
                        {% trans '尚在馆内' %}
                        {% elif book.status == 1 %}
                        {% trans '已预约' %}
                        {% elif book.status == 2 %}
                        {% trans '已借出' %}
                        {% elif book.status == 3 %}
                        {% trans '已丢失' %}
                        {% endif %}
                    </td>
                    <td>{{ book.the_book.place }}</td>
                {% if not administrator %}

{#                      {% if not administrator %}#}
                          {% if book.status == 0 %}
                            <td align="center"><button id="{{ book.book_id }}" class="reserve">{% trans '预约' %}</button></td>
                          {% else %}
                              <td align="center"><a >{% trans '无可预约数据' %}</a></td>
                          {% endif %}
                {% endif %}
                </tr>
            {% endfor %}

        </tbody>

    </table>
</body>
<script>
$.ajaxSetup({
    data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
});
$(".reserve").click(function(){
        var id = $(this).attr("id");
        $.post('{% url 'reserve_api' %}',{"book_id":id}, function (result, statue) {
                if(result["result"]===false){
                    alert("{% trans '图书预约失败!\n错误信息: ' %}"+ result['msg']);
                }else {
                    var this_button = document.getElementById(id);
                    this_button.disabled  = true;
                    this_button.innerText = "{% trans '预约成功' %}";
                    if(result["update"] === true){
                        alert("{% trans '该书已预约, 已更新预约时间!' %}")
                    }
                }
        })
    });

</script>

</html>