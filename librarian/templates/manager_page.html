<!DOCTYPE html>
<html>
<head>
    {% load static %}
    {% load i18n %}
<meta charset="UTF-8">
<title>manager</title>
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <link rel="icon" href="{% static 'images/favicon.ico' %}">
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'font/css/font-awesome.min.css' %}" rel="stylesheet">
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style type="text/css">
    body{
        background-image:url("{% static 'images/bg6.jpg' %}");
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-size: cover;
    }
    th {
    text-align: center;
}
tbody {
    text-align: center;
}
       .tab1 > tbody > tr:nth-child(2n-1) > td,
    .tab1 > tbody > tr:nth-child(2n-1) > th {
        {#background-color: #afd9ee;#}
         background-color: rgba(180,233,80,0.2);
     }

    .tab1 > tbody > tr:nth-child(2n) > td,
    .tab1 > tbody > tr:nth-child(2n) > th {
        {#background-color: #8EB2D2;#}
        background-color: rgba(120,100,130,0.2);
     }
    .unreturn > tbody > tr:nth-child(2n-1) > td,
    .unreturn > tbody > tr:nth-child(2n-1) > th {
        {#background-color: #afd9ee;#}
         background-color: rgba(180,233,80,0.2);
     }

    .unreturn > tbody > tr:nth-child(2n) > td,
    .unreturn > tbody > tr:nth-child(2n) > th {
        {#background-color: #8EB2D2;#}
        background-color: rgba(180,233,80,0.2);
     }
/* Custom Styles */
    ul.nav-tabs{
        width: 140px;
        margin-top: 20px;
        border-radius: 4px;
        border: 1px solid #ddd;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.067);
    }
    ul.nav-tabs li{
        margin: 0;
        border-top: 1px solid #ddd;
    }
    ul.nav-tabs li:first-child{
        border-top: none;
    }
    ul.nav-tabs li a{
        margin: 0;
        padding: 8px 16px;
        border-radius: 0;
    }
    ul.nav-tabs li.active a, ul.nav-tabs li.active a:hover{
        color: #fff;
        background: #0088cc;
        border: 1px solid #0088cc;
    }
    ul.nav-tabs li:first-child a{
        border-radius: 4px 4px 0 0;
    }
    ul.nav-tabs li:last-child a{
        border-radius: 0 0 4px 4px;
    }
    ul.nav-tabs.affix{
        top: 30px; /* Set the top position of pinned element */
    }
    div {
     display: block;
   }
		tr.t1{background:hsla(165,35%,50%,0.2);height:20px;}
		tr.t2{background:hsla(165,35%,50%,0.4);height:20px;}
		tr.t3{background:hsla(165,35%,50%,0.6);height:20px;}

		#login_click{ margin-top:20px; height:30px;}
		#login_click a {
			text-decoration:none;
			background:#2f435e;
			color:#f2f2f2;
			padding: 8px 20px 8px 20px;
			font-size:16px;	font-family: 微软雅黑,宋体,Arial,Helvetica,Verdana,sans-serif;
			font-weight:bold;
			border-radius:3px;
			-webkit-transition:all linear 0.30s;
			-moz-transition:all linear 0.30s;
			transition:all linear 0.30s;		}
		#login_click a:hover { background:#385f9e; }

		 #tab{font-size:16px;
			 font-family:楷体;
			 text-algn:right;
			 border-color:black;
			}
#menu li {
float: left;
position: relative;
}

#menu li a {
	color: #afd9ee;
	display: block;
	font-size: 14px;
	line-height: 20px;
	padding: 6px 12px;
	margin: 8px 8px;
	vertical-align: middle;
	text-decoration: none;
}

#menu li a:hover {
	background: -webkit-gradient(linear, center top, center bottom, from(#ededed), to(#fff));
	background-image: linear-gradient(#ededed, #fff);
	border-radius: 12px;
	box-shadow: inset 0px 0px 1px 1px rgba(0,0,0,0.1);
	color: #222;
}

/* Dropdown styles */

#menu ul {
	position: absolute;
	left: -9999px;
	list-style: none;
    padding: 0px;
	opacity: 0;
	transition: opacity 1s ease;
}

#menu ul li {
    float: none;
}

#menu ul a {
	white-space: nowrap;
}

/* Displays the dropdown on hover and moves back into position */
#menu li:hover ul {
	background: rgba(255,255,255,0.7);
	left: 5px;
	opacity: 1;
}

/* Persistant Hover State */
#menu li:hover a {
	background: -webkit-gradient(linear, center top, center bottom, from(#ccc), to(#ededed));
	background-image: linear-gradient(#ccc, #ededed);
	border-radius: 12px;
	box-shadow: inset 0px 0px 1px 1px rgba(0,0,0,0.1);
	color: #222;
}

#menu li:hover ul a {
	background: none;
	border-radius: 0;
	box-shadow: none;
}

#menu li:hover ul li a:hover {
	background: -webkit-gradient(linear, center top, center bottom, from(#eee), to(#fff));
	background-image: linear-gradient(#ededed, #fff);
	border-radius: 12px;
	box-shadow: inset 0px 0px 4px 2px rgba(0,0,0,0.3);
    color: blue;
}
</style>
</head>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="background-color: #003366;height:50px;">
    <div class="container"> 
        <div class="navbar-header"> 
            <a class="navbar-brand">Bibliosoft</a>
        </div>    
        <div> 
            <ul class="nav navbar-nav navbar-right" id="menu" style="left:0px; top:0px">
                <li>
                    <a style="cursor: pointer;">
                        <span class="fa fa-user fa-lg"></span>  {{ librarian_name }} <span class="caret"></span>
                    </a>
                    <ul style="text-align: center" id="manage">
                        <li><a href="{% url 'manager_add_reader' %}">{% trans '添加读者' %}</a></li>
                        <li><a href="{% url 'add_book' %}">{% trans '添加书籍' %}</a></li>
                        <li><a href="{% url 'update_book_message' %}">{% trans '编辑书籍' %}</a></li>
                        <li><a href="{% url 'edit_type_location' %}">{% trans '编辑信息' %}</a></li>
                        <li><a href="{% url 'manager_delete_book' %}">{% trans '删除书籍' %}</a></li>
                        <li><a href="{% url 'manager_del_record' %}">{% trans '删书记录' %}</a></li>
                        <li><a href="{% url 'manager_income_record' %}">{% trans '收入记录' %}</a></li>
                        <li><a href="{% url 'manager_post_news_record' %}">{% trans '推送公告' %}</a></li>
                    </ul>
                </li>
                <li><a href="{% url 'index' %}"><span class="glyphicon glyphicon-home"></span> {% trans '返回首页' %}</a></li>

            </ul> 
        </div> 
        <div class="btn-group navbar-btn" data-toggle="buttons">
                <form action="{% url 'set_language' %}" method="post" id="lang">
                {% csrf_token %}
                <input type="hidden" id="lang_s" name="language" value="en">
                <input name="next" type="hidden" value="{{ redirect_to }}"/>
                <label class="btn btn-primary active"  onclick="test('zh-hans')">
                    中文
                </label>
                <label class="btn btn-primary" onclick="test('en')">
                    English
                </label>
                </form>
        </div>
    </div> 
</nav>

<body data-spy="scroll" data-target="#myScrollspy">

<div style="text-align:center;margin-top: 40px">
    <img src="/static/images/book_logo.png" style="vertical-align:middle;" width="200"  />
</div>

<div class="container">
   
    <div class="row">
        <div class="col-xs-3" id="myScrollspy">
            <ul class="nav nav-tabs nav-stacked" data-spy="affix" data-offset-top="125" id="myNav">
                <li class="active"><a href="#section-1">{% trans '用户资料' %}</a></li>
                <li><a href="#section-2">{% trans '处理预约' %}</a></li>
				<li><a href="#section-3">{% trans '未还图书' %}</a></li>
                <li><a href="#section-4">{% trans '已还图书' %}</a></li>
                <li><a href="#section-5">{% trans '付费记录' %}</a></li>
            </ul>
        </div>
        <div class="input-group col-md-3" style="width: 600px;margin-left: auto;margin-right: auto" >
			<input type="text" size="50%" class="form-control" id="search_input"  placeholder="{% trans '请输入读者账户名或ID' %}" />
			<span class="input-group-btn">
				<button class="btn btn-info btn-search" onclick="search_user_message()">{% trans '查找' %}</button>
			</span>
        </div>
        <div class="col-xs-9 " style="float: right">
            <div id="section-1" style="position: relative; top: -50px;"></div>
            <h2 style="display:block; height:50px; width:350px">{% trans '用户资料' %}</h2>

	    <table align="center" id="tab" width="300px"  class="table tab1">

	        <thead>
                <tr>
                    <th align="center">{% trans '用户ID' %}</th>
                    <th align="center">{% trans '用户名' %}</th>
                    <th align="center">{% trans '邮箱' %}</th>
                    <th align="center">{% trans '缴纳罚金' %}</th>
                    <th align="center">{% trans '删除用户' %}</th>
                    <th align="center">{% trans '编辑用户' %}</th>
                </tr>
	        </thead>

            <tbody >
                <tr class="active" id="user_message_tr">
                </tr>
            </tbody>
        </table>
{# -----------------------------------------------------------------------------------------------------------------  #}
    <div class="input-group col-md-3" id="search_book_div" style="width: 600px;margin-left: auto;margin-right: auto;display: none;">
        <input type="text" class="form-control" id="book_input" placeholder="{% trans '请输入书籍id ' %}" style="width: 60%"/>
        <span class="input-group-btn">
            <button class="btn btn-info btn-search" onclick="search_book()">{% trans '搜索' %}</button>
        </span>
        <table align="center" id="tab" width="300px"  class="table tab1">
            <thead>
                <tr>
                    <th align="center">{% trans '书籍id' %}</th>
                    <th align="center">{% trans '书名' %}</th>
                    <th align="center">{% trans '状态' %}</th>
                    <th align="center">{%  trans '借阅' %}</th>
                </tr>
            </thead>
            <tbody id="book_borrow_directly_body">
            </tbody>
        </table>
    </div>
{# -------------------------------------------------------------------------------------------------------------------#}
    <hr>
            <div id="section-2" style="position: relative; top: -50px;"></div>
            <h2 style="display:block; height:50px; width:400px">{% trans '处理预约' %}</h2>


<table align="center" id="tab" width="300px"  class="table tab1">
	
	<thead>
		<tr >
            <th align="center">{% trans '订单号' %}</th>
			<th align="center">{% trans '书籍id' %}</th>
			<th align="center">{% trans '书名' %}</th>
			<th align="center">{% trans '预约时间' %}</th>
			<th align="center" style="width: 18%;">{%  trans '是否借阅' %}</th>
		</tr>
	</thead>

	<tbody id="reserve_table_body">
	</tbody>
</table>

            <hr>
            <div id="section-3" style="position: relative; top: -50px;"></div>
            <h2 style="display:block; height:50px; width:400px">{% trans '未还图书' %}</h2>


    <table align="center" id="tab" width="300px"  class="table unreturn">

        <thead>
        <tr >
            <th align="center">{% trans '订单号' %}</th>
            <th align="center">{% trans '书籍id' %}</th>
            <th align="center">{% trans '书名' %}</th>
            <th align="center">{% trans '借阅时间' %}</th>
            <th align="center">{% trans '欠费金额' %}</th>
            <th align="center">{%  trans '归还' %}</th>
            <th align="center" style="width: 20%;">{%  trans '归还提醒' %}</th>
        </tr>
        </thead>
	<tbody id="unreturned_book_tbody">

	</tbody>
</table>
    <div id="section-4" style="position: relative; top: -50px;"></div>
            <h2 style="display:block; height:50px; width:400px">{% trans '已还图书' %}</h2>

    <h4>{% trans "待付金额：" %}<span id="all_fine"></span>&nbsp;￥</h4>
    <table align="center" id="tab" width="300px"  class="table tab1">

        <thead>
        <tr >
            <th align="center">{% trans '订单号' %}</th>
            <th align="center">{% trans '书籍id' %}</th>
            <th align="center">{% trans '书名' %}</th>
            <th align="center">{% trans '归还时间' %}</th>
            <th align="center">{% trans '欠费金额' %}</th>
        </tr>
        </thead>
	<tbody id="returned_book_tbody">

	</tbody>
</table>

    <div id="section-5" style="position: relative; top: -50px;"></div>
            <h2 style="display:block; height:50px; width:400px">{% trans '付费记录' %}</h2>


            <table align="center" id="tab" width="300px"  class="table tab1">

                <thead>
                <tr >
                    <th align="center">{% trans '订单号' %}</th>
                    <th align="center">{% trans '付费类型' %}</th>
                    <th align="center">{% trans '用户名' %}</th>
                    <th align="center">{% trans '缴纳时间' %}</th>
                    <th align="center">{% trans '收款人' %}</th>
                    <th align="center">{% trans '缴纳金额' %}</th>

                </tr>
                </thead>
                <tbody id="money_orders">


                </tbody>
            </table>

        </div>
    </div>
</div>

<footer style="color: #000000;font-size: .60em;font-style: italic;text-align: center;">
京 ICP备 09067229号   京公网安备 110105000296   版权所有 A14组
<br>
Copyright &copy;2018 Library
<br>
<a href="#">xiaoxiongxiong@xiongxiong.com</a>
</footer>

<script>
    var fn;
        $.ajaxSetup({
    data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
});
    $(document).ready(function () {
        $('#search_input').bind('keypress',function(event){
            if (event.keyCode == "13") {
               this.value = parseInt(this.value)
               search_user_message();
            }
        });
        $('#book_input').bind('keypress',function(event){
            if (event.keyCode == "13") {
                this.value = parseInt(this.value)
               search_book();
            }
        });
    });

    function pay_debt(username) {
        $.get("{% url 'manager_pay_debt_api' %}", {'username': username}, function(result){
            if(result["result"] === true){
                alert("{% trans "缴纳罚金成功" %}");
                search_user_message();
            }else {
                alert("Failed!\n" + result['msg']);
            }
        });
    }

    function delete_reader(name) {
        var fine = document.getElementById("all_fine").innerText;
        fine = parseFloat(fine);
        if(fine > 0){
            alert("{% trans '请先缴纳罚金：' %}"+fine+" ￥");
            return;
        }
        $.get("{% url 'manager_delete_reader' %}", {'username':name}, function(result){
            if(result["result"] === true){
                alert("{% trans "删除成功" %}");
                document.getElementById("user_message_tr").innerText = "";
                document.getElementById("reserve_table_body").innerText = "";
                document.getElementById("return_book_tbody").innerText = "";
            }else {
                alert("Failed!\n message:" + result["msg"]);
            }
        });
    }

    function return_book(order_id) {
        //归还图书函数
        $.post("{% url 'manage_return_book_api' %}", {'borrow_id':order_id}, function(result){
            if(result["result"] === true){
                search_user_message();
            }else {
                alert("Failed!\n message:"+result["msg"])
            }
        });
    }
    function borrow_book(order_id) {
        // 借阅 函数
        $.post("{% url 'manage_borrow_book_api' %}", {'reserve_id':order_id}, function(result){
            if(result["result"] === true){
                if(result["expire"]===true){
                    alert("{% trans '该订单已过期！' %}")
                }
                search_user_message();
            }else {
                alert("Failed!\n message:"+result["msg"])
            }
        });
    }
     function send_mail(order_id) {
        //向逾期用户发送邮件提醒
        $.post("{% url 'manage_send_mail_api' %}", {'borrow_id':order_id}, function(result){
            if(result["result"] === true){
                {#search_user_message(); #}
                alert("Successful!\n message:"+result["msg"])
            }else {
                alert("Failed!\n message:"+result["msg"])
            }
        });
    }

    function  add_user_message(user) {
        // 动态添加读者信息
        //
        var user_parent = document.getElementById("user_message_tr");
        user_parent.innerText = "";
        var td = document.createElement("td");
        td.innerText = user["user_id"];
        user_parent.appendChild(td);
        var td_1 = document.createElement("td");
        td_1.innerText = user["user_name"];
        user_parent.appendChild(td_1);
        var td_2 = document.createElement("td");
        td_2.innerText = user["email"];
        user_parent.appendChild(td_2);

        var td_3 = document.createElement("td");
        var debt_button = document.createElement("button");
        debt_button.innerText = "{% trans '缴纳' %}";
        debt_button.className = "btn btn-success btn-sm";
        debt_button.setAttribute("onclick", "pay_debt("+"\""+user["user_name"]+"\""+")");
        td_3.appendChild(debt_button);

        var td_4 = document.createElement("td");
        var delete_user_button = document.createElement("button");
        delete_user_button.innerText = "{% trans '删除' %}";
        delete_user_button.className = "btn btn-danger btn-sm";
        delete_user_button.setAttribute("onclick", "delete_reader("+"\""+user["user_name"]+"\""+")");
        td_4.appendChild(delete_user_button);

        var td_5 = document.createElement("td");
        var edit_user_button = document.createElement("button");
        edit_user_button.innerText = "{% trans '编辑' %}";
        edit_user_button.className = "btn btn-success btn-sm";
        edit_user_button.setAttribute("onclick", "$(window).attr('location', '/update_reader/?username="+user["user_name"]+"&email="+user["email"]+"');");
        //edit_user_button.setAttribute("onclick", "window.open('/update_reader/?username="+user["user_name"]+"&email="+user["email"]+"')");
        td_5.appendChild(edit_user_button);
        user_parent.appendChild(td_3);
        user_parent.appendChild(td_4);
        user_parent.appendChild(td_5);

    }
    function  add_reserve_order(reserve_orders) {
        // 动态添加 预约 订单
        var reserve_tbody = document.getElementById("reserve_table_body");
        reserve_tbody.innerText = "";
        for( var i=0;i<reserve_orders.length;i++){
            var tr = document.createElement("tr");
            tr.setAttribute("class", "active");
            var td = document.createElement("td");
            var td_1 = document.createElement("td");
            var td_2 = document.createElement("td");
            var td_3 = document.createElement("td");
            var td_4 = document.createElement("td");
            td.innerText = reserve_orders[i]["reserve_order_id"];
            td_1.innerText = reserve_orders[i]["reserve_book_id"];
            td_2.innerText = reserve_orders[i]["reserve_book_name"];
            td_3.innerText = reserve_orders[i]["reserve_time"];
            td_4.setAttribute("width","100px");
            var button = document.createElement("button");
            button.setAttribute("name", "借阅");
            button.setAttribute("onclick", "borrow_book("+reserve_orders[i]["reserve_order_id"].toString()+")");
            button.innerText = "{%  trans '借阅' %}";
            button.className = "btn btn-success btn-sm";
            td_4.appendChild(button);
            tr.appendChild(td);
            tr.appendChild(td_1);
            tr.appendChild(td_2);
            tr.appendChild(td_3);
            tr.appendChild(td_4);
            reserve_tbody.appendChild(tr)
        }
    }
    function add_borrow_order(borrow_orders) {
        //添加 借阅图书
        var parent = document.getElementById("unreturned_book_tbody");
        parent.innerText = "";
        for( var i=0;i<borrow_orders.length;i++){
            var tr = document.createElement("tr");
            tr.setAttribute("class", "active");
            var td = document.createElement("td");
            var td_1 = document.createElement("td");
            var td_2 = document.createElement("td");
            var td_3 = document.createElement("td");
            var td_4 = document.createElement("td");
            var td_5 = document.createElement("td");
            var td_6 = document.createElement("td");
            td.innerText = borrow_orders[i]["borrow_order_id"];
            td_1.innerText = borrow_orders[i]["borrow_book_id"];
            td_2.innerText = borrow_orders[i]["borrow_book_name"];
            td_3.innerText = borrow_orders[i]["borrow_time"];
            td_4.innerText = borrow_orders[i]["debt"];
            td_5.setAttribute("width","100px");
            td_6.setAttribute("width","100px");
            var button = document.createElement("button");
            button.setAttribute("onclick", "return_book("+borrow_orders[i]["borrow_order_id"].toString()+")");
            button.innerText = "{%  trans '归还' %}";
            button.className = "btn btn-success btn-sm";
            var button1 = document.createElement("button");
            button1.setAttribute("onclick", "send_mail("+borrow_orders[i]["borrow_order_id"].toString()+")");
            button1.innerText = "{%  trans '发邮件' %}";
            button1.className = "btn btn-success btn-sm";
            td_5.appendChild(button);
            td_6.appendChild(button1);
            tr.appendChild(td);
            tr.appendChild(td_1);
            tr.appendChild(td_2);
            tr.appendChild(td_3);
            tr.appendChild(td_4);
            tr.appendChild(td_5);
            tr.appendChild(td_6);
            parent.appendChild(tr);
        }
    }

    function add_returned_order(returned_orders, allFine) {
        //添加总罚金
        var fine = document.getElementById("all_fine");
        fine.innerText = allFine;
        //添加 已归还图书
        var parent = document.getElementById("returned_book_tbody");
        parent.innerText = "";
        for( var i=0;i<returned_orders.length;i++){
            var tr = document.createElement("tr");
            tr.setAttribute("class", "active");
            var td = document.createElement("td");
            var td_1 = document.createElement("td");
            var td_2 = document.createElement("td");
            var td_3 = document.createElement("td");
            var td_4 = document.createElement("td");

            td.innerText = returned_orders[i]["borrow_order_id"];
            td_1.innerText = returned_orders[i]["borrow_book_id"];
            td_2.innerText = returned_orders[i]["borrow_book_name"];
            td_3.innerText = returned_orders[i]["return_time"];
            td_4.innerText = returned_orders[i]["debt"];

            tr.appendChild(td);
            tr.appendChild(td_1);
            tr.appendChild(td_2);
            tr.appendChild(td_3);
            tr.appendChild(td_4);

            parent.appendChild(tr);
        }
    }

    function add_money_order(money_orders){
        var parent = document.getElementById("money_orders");
        parent.innerText = "";
        for( var i=0;i<money_orders.length;i++){
            var tr = document.createElement("tr");
            tr.setAttribute("class", "active");
            var td = document.createElement("td");
            var td_1 = document.createElement("td");
            var td_2 = document.createElement("td");
            var td_3 = document.createElement("td");
            var td_4 = document.createElement("td");
            var td_5 = document.createElement("td");

            td.innerText = money_orders[i]["id"];
            td_1.innerText = money_orders[i]["order_type"];
            td_2.innerText = money_orders[i]["user_name"];
            td_3.innerText = money_orders[i]["order_time"];
            td_4.innerText = money_orders[i]["librarian"];
            td_5.innerText = money_orders[i]["num"];

            tr.appendChild(td);
            tr.appendChild(td_1);
            tr.appendChild(td_2);
            tr.appendChild(td_3);
            tr.appendChild(td_4);
            tr.appendChild(td_5);

            parent.appendChild(tr);
        }
    }
    function search_user_message() {
        // 搜索用户信息
        var user_name = $("#search_input").val();
        if (user_name == ''){
            alert("{% trans '输入为空！' %}");
            return;
        }
        //user_name = parseInt(user_name);
        $.post('{% url 'manage_user_message_api' %}',{"user_name":user_name},function(result, statue){
                if(result["result"] === true){
                        var user = result["user_message"];
                        add_user_message(user);
                        var reserve_orders = result["reserve_orders"];
                        add_reserve_order(reserve_orders);
                        var borrow_orders = result["borrow_orders"];
                        add_borrow_order(borrow_orders);
                        var returned_orders = result["returned_orders"];
                        var all_fine = result["all_fine"];
                        add_returned_order(returned_orders, all_fine);
                        var money_orders = result["money_orders"];
                        add_money_order(money_orders);
                        document.getElementById("search_book_div").style.display="block";
                }else {
                    alert("Failed!\n message:"+result["msg"])
                }
        });
    }
{#--------------------------------------------------------------------------------------------------------------------#}
    function search_book() {
        var parent = document.getElementById("book_borrow_directly_body");
        parent.innerText ="";
        var book_id = $("#book_input").val();
        if (book_id == ''){
            alert("{% trans '输入为空！' %}");
            return;
        }
        $.post('{% url 'book_detail_api' %}',{"book_id":book_id},function(result, statue){
            if(result["result"] === true){
                var book_name = result["book_name"];
                var book_place = result["book_place"];
                var book_status = result["book_status"];
                var tr = document.createElement("tr");
                var td_1 = document.createElement("td");
                var td_2 = document.createElement("td");
                var td_3 = document.createElement("td");
                var td_4 = document.createElement("td");
                td_1.innerText=book_id;
                td_2.innerText = book_name;
                if(book_status ===0){
                    td_3.innerText ="{% trans '可借阅' %}";
                } if(book_status===1){
                    td_3.innerText ="{% trans '已预约' %}";
                }else if(book_status===2){
                    td_3.innerText ="{% trans '已借出' %}";
                }else if(book_status===3){
                    td_3.innerText ="{% trans '已删除' %}";
                }
                if(book_status===0){
                    var button = document.createElement("button");
                    button.setAttribute("onclick", "directly_borrow_book("+book_id+")");
                    button.innerHTML = "{%  trans '借阅' %}";
                    button.className = "btn btn-success btn-sm";
                    td_4.appendChild(button)
                }else{
                    td_4.innerHTML ="<font color=red>{% trans '不可借阅' %}</font>";
                }
                tr.appendChild(td_1);
                tr.appendChild(td_2);
                tr.appendChild(td_3);
                tr.appendChild(td_4);
                parent.appendChild(tr);
                }
            else {
                alert("Failed!\n message:"+result["msg"])
            }
         });
    }
    function  directly_borrow_book(book_id) {
        var user_name = $("#search_input").val();
        //user_name = parseInt(user_name);
        $.post('{% url 'borrow_book_directly_api' %}',{"book_id":book_id,"user_name":user_name},function(result, statue) {
            if(result["result"]===true){
                alert("{% trans '借阅成功' %}");
                search_user_message();
                search_book(book_id);
            }else {
                alert("Failed!\n message:"+result["msg"]);
            }
        });
    }
{#--------------------------------------------------------------------------------------------------------------------#}
        function test(str){
        var li=document.getElementById("lang").getElementsByTagName("input");
        li[1].value=str;
        document.getElementById("lang").submit();
        //submit
    }
</script>
</body>
</html>
